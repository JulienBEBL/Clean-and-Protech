logging:
  enabled: true
  directory: logs
  level: INFO

i2c:
  bus: 1

  mcp1: 0x24     # Programmes (LED + boutons)
  mcp2: 0x25     # Sélecteurs VIC / AIR
  mcp3: 0x26     # Drivers moteurs (ENA + DIR)

  lcd: 0x27

gpio:
  step_pins:
    M1: 17
    M2: 27
    M3: 22
    M4: 5
    M5: 18
    M6: 23
    M7: 24
    M8: 25

  relays:
    air: 16
    pump: 20

  flowmeter: 21

  buzzer: 26

flowmeter:
  pulses_per_liter: 12
  debounce_ms: 2

vic:
  motor: M1
  positions_steps:
    1: 0     # Départ
    2: 250   # Inter_D
    3: 400   # Neutre
    4: 550   # Inter_R
    5: 800   # Retour

motors:
  steps_per_rev: 3200
  default_rpm: 30
  min_rpm: 1
  max_rpm: 400
  accel_rpm_per_s: 100
  vic_motor: M1

mcp23017:
  mcp1_programs:
    # Banques A/B pour boutons et LEDs.
    buttons_bank: B
    leds_bank: A

    # Bits utilisés pour les boutons programmes (B0..B5).
    # Ordre = numéro de programme (index 0 => PRG1, etc.).
    buttons_bits: [0, 1, 2, 3, 4, 5]

    # Bits utilisés pour les LEDs programmes (A2..A7).
    # Ordre = numéro de programme (index 0 => PRG1, etc.).
    leds_bits:    [2, 3, 4, 5, 6, 7]

    # Pull-up internes activés sur les entrées boutons.
    buttons_pullup: true

  mcp2_selectors:
    vic_bank: B
    air_bank: A

    # Bit pour la demande AIR (on/off).
    air_bit: 0

    # Bits pour le sélecteur VIC (ex: 5 positions B0..B4).
    # Le code lira cet ensemble comme un vecteur de 5 bits.
    vic_bits: [0, 1, 2, 3, 4]

    pullup: true

  mcp3_drivers:
    dir_bank: A
    ena_bank: B

    # ENA actif bas sur DM860H => 0 = activé, 1 = désactivé.
    ena_active_low: true

    # Index de bit (0..7) pour chaque moteur sur chaque banque.
    motors:
      M1: 0
      M2: 1
      M3: 2
      M4: 3
      M5: 4
      M6: 5
      M7: 6
      M8: 7

programs:
  1:
    name: "Premiere Vidange"
    enabled: true
    # Durée par défaut en secondes (0 = illimité jusqu'à appui sur le bouton).
    default_duration_sec: 0
    safety:
      air:
        mode: manual       # AIR manuel
      vic:
        mode: auto         # V4V auto (position fixée par le programme, plus tard)
        auto_position_index: 0
      pump:
        mode: auto         # pompe gérée par le programme
        start_on_program: true
        stop_on_program_end: true

  2:
    name: "Vidange Cuve Travail"
    enabled: true
    default_duration_sec: 0
    safety:
      air:
        mode: blocked      # AIR bloqué pour sécurité
      vic:
        mode: auto         # V4V auto, position intermédiaire
        auto_position_index: 2
      pump:
        mode: auto
        start_on_program: true
        stop_on_program_end: true

  3:
    name: "Sechage"
    enabled: true
    default_duration_sec: 0
    safety:
      air:
        mode: manual       # AIR manuel
      vic:
        mode: auto
        auto_position_index: 0
      pump:
        mode: auto
        start_on_program: true
        stop_on_program_end: true

  4:
    name: "Remplissage Cuve"
    enabled: true
    default_duration_sec: 0
    safety:
      air:
        mode: blocked      # AIR bloqué
      vic:
        mode: auto
        auto_position_index: 0
      pump:
        mode: auto
        start_on_program: true
        stop_on_program_end: true

  5:
    name: "Desembouage"
    enabled: true
    default_duration_sec: 0
    safety:
      air:
        mode: manual       # AIR manuel
      vic:
        mode: manual       # V4V en manuel (opérateur)
        auto_position_index: 0
      pump:
        mode: auto
        start_on_program: true
        stop_on_program_end: true
