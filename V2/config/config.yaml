# ------------------------------------------------------------
# CONFIGURATION GLOBALE MACHINE - Clean & Protech
# ------------------------------------------------------------

logging:
  dir: "/var/log/machine_ctrl"
  level: "INFO"

# ------------------------------------------------------------
# I2C
# ------------------------------------------------------------
i2c:
  bus: 1

  # MCP23017
  mcp1: 0x24     # Programmes (LED + boutons)
  mcp2: 0x25     # Sélecteurs VIC / AIR
  mcp3: 0x26     # Drivers moteurs (ENA + DIR)

  # LCD I2C (PCF8574)
  lcd: 0x27


# ------------------------------------------------------------
# GPIO (BCM)
# ------------------------------------------------------------
gpio:

  lgpio_chip: 0

  # STEP (PUL) moteurs directs GPIO
  step_pins:
    M1: 17
    M2: 27
    M3: 22
    M4: 5
    M5: 18
    M6: 23
    M7: 24
    M8: 25

  # Relais critiques (actifs HIGH)
  relays:
    air: 16
    pump: 20

  # Débitmètre YF-DN50
  flowmeter: 21

  # Buzzer
  buzzer: 26


# ------------------------------------------------------------
# MOTEURS
# ------------------------------------------------------------
motors:

  microsteps_per_rev: 3200

  # temporisations logiques
  ena_settle_ms: 10
  dir_setup_us: 5

  # Inversion sens si nécessaire (par moteur)
  invert_dir:
    M1: false
    M2: false
    M3: false
    M4: false
    M5: false
    M6: false
    M7: false
    M8: false

  # Valeurs par défaut mouvement
  default_motion:
    max_rpm: 40.0
    accel_rpm_s: 80.0

  # Paramètres ouverture/fermeture
  open_close:
    turns: 10.0        # 10 tours = ouverture/fermeture complète
    max_rpm: 30.0
    accel_rpm_s: 60.0


# ------------------------------------------------------------
# INITIALISATION MOTEURS AU BOOT
# ------------------------------------------------------------
motor_init:

  enabled: true

  mode: "open_all"      # open_all / close_all / none

  turns: 10.0
  max_rpm: 30.0
  accel_rpm_s: 60.0

  disable_after: true


# ------------------------------------------------------------
# INPUTS (MCP1 + MCP2)
# ------------------------------------------------------------
inputs:

  poll_hz: 100
  debounce_ms: 30

  active_low_buttons: true
  active_low_selectors: true


# ------------------------------------------------------------
# FLOWMETER
# ------------------------------------------------------------
flowmeter:

  pulses_per_liter: 12.0
  sample_period_s: 1.0

  # FALLING recommandé pour ton montage NPN
  edge: "FALLING"

  # filtre anti-glitch logiciel (ms)
  min_pulse_interval_ms: 2


# ------------------------------------------------------------
# BUZZER
# ------------------------------------------------------------
buzzer:

  active_high: true

  # valeurs par défaut
  default_freq_hz: 2000
  default_duration_s: 0.12


# ------------------------------------------------------------
# PROGRAMMES (noms affichage LCD)
# ------------------------------------------------------------
programs:

  1: "Premiere Vidange"
  2: "Vidange Cuve Travail"
  3: "Sechage"
  4: "Remplissage Cuve"
  5: "Desembouage"
  6: "Reserve"
